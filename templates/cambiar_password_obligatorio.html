{% extends "base.html" %}

{% block title %}Cambio de Contraseña Obligatorio{% endblock %}

{% block content %}
<div class="row justify-content-center min-vh-100 align-items-center">
    <div class="col-md-6">
        <div class="card shadow-lg border-warning">
            <div class="card-header bg-warning text-dark text-center">
                <i class="fas fa-shield-alt fa-3x mb-3"></i>
                <h3 class="mb-0">Cambio de Contraseña Obligatorio</h3>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Por tu seguridad:</strong> Debes cambiar tu contraseña temporal antes de continuar.
                </div>

                {% if password_temporal %}
                <div class="alert alert-info">
                    <i class="fas fa-key me-2"></i>
                    <strong>Tu contraseña temporal actual es:</strong>
                    <div class="mt-2">
                        <code class="fs-5 text-dark bg-light p-2 rounded d-inline-block">{{ password_temporal }}</code>
                    </div>
                    <small class="d-block mt-2 text-muted">Úsala para verificar tu identidad.</small>
                </div>
                {% endif %}

                <form method="POST" novalidate>
                    {{ form.hidden_tag() }}
                    
                    <div class="mb-3">
                        {{ form.password_actual.label(class="form-label") }}
                        <div class="input-group">
                            {{ form.password_actual(class="form-control", id="password_actual", type="password") }}
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password_actual', 'icon_actual')">
                                <i class="fas fa-eye" id="icon_actual"></i>
                            </button>
                        </div>
                        {% if form.password_actual.errors %}
                            {% for error in form.password_actual.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form.nueva_password.label(class="form-label") }}
                        <div class="input-group">
                            {{ form.nueva_password(class="form-control", id="nueva_password", type="password") }}
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('nueva_password', 'icon_nueva')">
                                <i class="fas fa-eye" id="icon_nueva"></i>
                            </button>
                        </div>
                        {% if form.nueva_password.errors %}
                            {% for error in form.nueva_password.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                        <div class="form-text">
                            <i class="fas fa-info-circle me-1"></i>
                            Mínimo 6 caracteres. Se recomienda usar una combinación de letras, números y símbolos.
                        </div>
                    </div>

                    <div class="mb-4">
                        {{ form.confirmar_password.label(class="form-label") }}
                        <div class="input-group">
                            {{ form.confirmar_password(class="form-control", id="confirmar_password", type="password") }}
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmar_password', 'icon_confirmar')">
                                <i class="fas fa-eye" id="icon_confirmar"></i>
                            </button>
                        </div>
                        {% if form.confirmar_password.errors %}
                            {% for error in form.confirmar_password.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="alert alert-success">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Recomendaciones para una contraseña segura:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Usa al menos 8 caracteres</li>
                            <li>Incluye letras mayúsculas y minúsculas</li>
                            <li>Agrega números y símbolos especiales</li>
                            <li>No uses información personal obvia</li>
                        </ul>
                    </div>

                    <div class="d-grid">
                        {{ form.submit(class="btn btn-warning btn-lg") }}
                    </div>
                </form>

                <div class="text-center mt-3">
                    <small class="text-muted">
                        <i class="fas fa-lock me-1"></i>
                        Esta acción es obligatoria para proteger tu cuenta.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function togglePassword(inputId, iconId) {
    const passwordInput = document.getElementById(inputId);
    const icon = document.getElementById(iconId);
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}
</script>

<style>
    /* Ocultar el navbar para la página de cambio obligatorio */
    nav.navbar {
        display: none;
    }
</style>
{% endblock %}
